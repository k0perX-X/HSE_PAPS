# Лабораторная работа № 3

## Диаграмма компонентов 

На диаграмме последовательности отображены компоненты которые либо относятся к системе учета аренды, либо взаимодействуют с ним напрямую. 

В систему учета аренды входят API Server и 3 СУБД, две из 3 СУБД являются классическими реляционными базами данных, разделение их связано с требованиями законодательства РФ о защите персональных данных, из-за которых аренда серверов предназначенных для хранения персональных данных стоит значительно больше, поэтому было принято решение о выделении отдельного сервера под защищенную базу данных. Третья СУБД временных рядов предназначена для хранения информации о проводимых операциях и событиях для обеспечения более удобного анализа данных. API Server включает в себя контролеры подключения баз данных, а также контроллер управления API.

![Диаграмма компонентов](docs/Lab2-С3%20API%20Server.drawio.png)

## Диаграмма последовательности 

На диаграмме последовательности представлен процесс "Взять плед в аренду". 

Первым этапом является авторизация и аутентификация пользователя, представленная на отдельной диаграмме последовательности ниже.

Далее клиент выбирает тариф и способ оплаты, после чего инициирует запрос ВзятьПлед, от сайта посылается запрос к Системе учета аренды (на картинке отмечено как Ядро) со всеми выбранными ранее параметрами заказа. Далее происходит резервирование пледа в ячейке автомата, отправляется запрос на оплату. В случае прохождения операции оплаты, отправляется запрос на на выдачу пледа, клиенту сообщается о номере ячейки с пледом. В случае ошибки оплаты, отправляется ответ об отмене резервирования, клиенту сообщается об ошибке.

![Диаграмма последовательности "Взять плед в аренду"](docs/Get%20a%20blanket%20IT-Последовательность%20_Взять%20плед_.drawio.png)

На диаграмме ниже представлена последовательность "Авторизация по телефону". Она в большей степени описывает работу Сервиса авторизации, который не рассматривается в данной работе, поэтому описаны будут только запросы, которые относятся к Системе учета аренды (на картинке отмечено как Ядро). 

При проведении любой операции требующей авторизации (например, ЗапросСпособовОплаты, представленный на предыдущей диаграмме) Системе учета аренды проводит проверку верности JWT-токена, в случае верности проводит операцию, в ином случае возвращает HTTP код 401.

Операция ПолучитьДоступныеРегионы не требует авторизации, поэтому она не требует наличия токена, этот запрос может сделать любой в любой момент. 

Операция ПолучитьUserID доступна только Сервису авторизации. Запрос производится только в случае валидации соответствия пары приватного и публичного ключей.

![Диаграмма последовательности "Авторизация по телефону"](docs/Get%20a%20blanket%20IT-Последовательность%20_Авторизация%20по%20телефону_.drawio.png)

## Диаграмма базы данных 

На диаграмме ниже представлена схема базы данных необходимая для реализации функций описанных на диаграммах выше. Внутри поля Защищенная база данных, находятся таблицы, которые требуют защиты в соответствии с 152-ФЗ "О персональных данных". Остальные (одна) таблицы, не требующие защиты представлены вне поля.

![Диаграмма базы данных](docs/Get%20a%20blanket%20IT-Схема%20базы%20данных%20Сore.drawio.png)

Диаграмма базы данных изменялась в ходе разработки, поэтому изменения помечены красным.

## Связь с принципами программирования
 
**Принцип KISS (Keep It Simple, Stupid):**
Простота кода: C# позволяет выносить разные компоненты проекта в разные namespace, что позволяет значительно упростить поиск по коду.

**Принцип YAGNI (You Aren't Gonna Need It):**
Минимальный функционал: Каждый компонент проекта отвечает только за свою функцию, так например namespace GaB_Core.Controllers хранит в себе только контроллеры API.

**Принцип DRY (Don't Repeat Yourself):**
Использование функций: Для доступа БД используется ORM, а для доступа к ORM созданы функции GetProtectedContext и GetUnprotectedContext, используемые по всему проекту.

**Принципы SOLID:**
 
_Single Responsibility Principle (Принцип единственной ответственности):_
Пример: namespace GaB_Core.Controllers отвечает только за описание API, за описание взаимодействия с БД отвечают namespace GaB_Core.ProtectedDbConnector и GaB_Core.UnprotectedDbConnector.

_Open/Closed Principle (Принцип открытости/закрытости):_
Пример: Код легко расширяем без изменения существующего кода. Например, можно добавлять новые контроллеры, которые не будут затрагивать старые.

_Liskov Substitution Principle (Принцип подстановки Лисков):_
Пример: Функции и методы могут использовать интерфейсы и наследование классов для обработки запросов без знания о конкретной реализации, например можно создавать новые контроллеры API наследуя класс ControllerBase, что обеспечивает замену компонентов без нарушения функциональности.

_Interface Segregation Principle (Принцип разделения интерфейса):_
Пример: ControllerBase предоставляет механизмы для создания и обработки маршрутов, позволяя разделять обработчики запросов по разным эндпоинтам для разделения функциональности и соблюдения чистоты кода.

_Dependency Inversion Principle (Принцип инверсии зависимостей):_
Пример: Функции контроллеров не зависят от конкретной реализации базы данных, а опираются на ORM, представляющий данные в виде классов, что позволяет в случае необходимости изменить структуру базы данных или модифицировать методы доступа к данным без изменения логики самой функции.
